<!doctype html>
<html class="no-js">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><link rel="index" title="Index" href="../../genindex/" /><link rel="search" title="Search" href="../../search/" /><link rel="next" title="Design Notes" href="../design/" /><link rel="prev" title="Workflow" href="../workflow/" />

    <meta name="generator" content="sphinx-3.5.4, furo 2021.04.11.dev35"/>
        <title>Internals - Furo</title>
      <link rel="stylesheet" href="../../_static/styles/furo.css?digest=0c495c4b9eb7efc2ca9afa7aec7358551979c740">
    <link rel="stylesheet" href="../../_static/pygments.css">
    <link media="(prefers-color-scheme: dark)" rel="stylesheet" href="../../_static/pygments_dark.css">
    


<style>
  :root {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media (prefers-color-scheme: dark) {
    :root {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
  }

  /* For allowing end-user-specific overrides */
  .override-light {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  .override-dark {
    --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
  }
</style><link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css" />
    <link rel="stylesheet" href="../../_static/styles/furo-extensions.css?digest=d391b54134226e4196576da3bdb6dddb7e05ba2b"></head>
  <body dir="">
    
<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke-width="1.5" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round">
      <path stroke="none" d="M0 0h24v24H0z"/>
      <line x1="4" y1="6" x2="20" y2="6" />
      <line x1="10" y1="12" x2="20" y2="12" />
      <line x1="6" y1="18" x2="20" y2="18" />
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
      stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
      class="feather feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation"></label>
<label class="overlay toc-overlay" for="__toc"></label>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../"><div class="brand">Furo</div></a>
    </div>
    <div class="header-right">
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../">
  
  
  <span class="sidebar-brand-text">Furo</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search/">
  <input class="sidebar-search" placeholder=Search name="q">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form><div class="sidebar-scroll"><div class="sidebar-tree">
  <ul>
<li class="toctree-l1"><a class="reference internal" href="../../quickstart/">Quickstart</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../customisation/">Customisation</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label for="toctree-checkbox-1"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../customisation/logo/">Adding a logo</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../customisation/colors/">Changing colors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../customisation/fonts/">Changing fonts</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../customisation/landing-page/">Changing landing page</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../customisation/sidebar/">Changing sidebar elements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../customisation/toc/">Hiding Contents sidebar</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../customisation/injecting/">Injecting code</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../reference/">Reference</a><input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label for="toctree-checkbox-2"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../reference/text-formatting/">Text Formatting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/admonitions/">Admonitions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/api/">API documentation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/code-blocks/">Code Blocks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/hyperlinks/">Hyperlinks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/images/">Images</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/lists/">Lists</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/tables/">Tables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/tabs/">Tabs</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../recommendations/">Recommendations</a></li>
</ul>
<p class="caption"><span class="caption-text">Development</span></p>
<ul class="current">
<li class="toctree-l1 current has-children"><a class="reference internal" href="../">Contributing</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label for="toctree-checkbox-3"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../workflow/">Workflow</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Internals</a></li>
<li class="toctree-l2"><a class="reference internal" href="../design/">Design Notes</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../kitchen-sink/">Kitchen Sink</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label for="toctree-checkbox-4"><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../kitchen-sink/demo/">Paragraph Level Markup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kitchen-sink/lists_tables/">Lists &amp; Tables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kitchen-sink/really-long/">Really Long Page</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kitchen-sink/structure/">Structural Elements</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../kitchen-sink/structure/#structural-elements-2">Structural Elements 2</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog/">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../license/">License</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/pradyunsg/furo">GitHub Repository</a></li>
</ul>

</div>
</div>
      </div>
      
    </div>
  </aside>
  <main class="main">
    <div class="content">
      <article role="main">
        <label class="toc-overlay-icon toc-content-icon" for="__toc">
          <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
        </label>
        <div class="section" id="internals">
<h1>Internals<a class="headerlink" href="#internals" title="Permalink to this headline">¶</a></h1>
<p>Furo’s internals contain an interesting mix of stupid-things-that-work and all kinds of bodges. Most of this project was built slowly over the span of a few weeks, as a part of an attempt to take a break from working on Python packaging stuff.</p>
<div class="section" id="repository-layout">
<h2>Repository Layout<a class="headerlink" href="#repository-layout" title="Permalink to this headline">¶</a></h2>
<p>The repository layout is pretty standard for a Python project, with a few quirks due to the need for compiling Sass and JS files.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">CODE_OF_CONDUCT.md</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">LICENSE</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">README.md</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">.nox/</span></code> – Generated by <a class="reference external" href="https://nox.readthedocs.io/">nox</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dist/</span></code> – Generated as part of the release process.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">docs/</span></code> – Sources for the documentation.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">src/</span></code></p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">furo/</span></code> – actual source code for the package</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">__init__.py</span></code> – Handles interaction with Sphinx and some configuration.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">navigation.py</span></code> – Generates the sidebar navigation HTML.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sphinxext.py</span></code> – Defines the internal-only <code class="docutils literal notranslate"><span class="pre">furo-demo</span></code> directive.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">assets/</span></code> – contains Sass and JS source code.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">theme/</span></code> – the folder that Sphinx adds to template lookup.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">furo/</span></code> – main Sphinx theme folder</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">static/</span></code> – contains compiles CSS and JS code.</p></li>
<li><p>everything else here – the underlying HTML templates.</p></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">gulpfile.js</span></code> – for <a class="reference external" href="https://gulpjs.com/">Gulp</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">noxfile.py</span></code> – for <a class="reference external" href="https://nox.readthedocs.io/">nox</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">package.json</span></code> – for <a class="reference external" href="https://npmjs.com/">NPM</a>.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pyproject.toml</span></code> – for Python Packaging.</p></li>
</ul>
</div>
<div class="section" id="theme-build-process">
<h2>Theme build process<a class="headerlink" href="#theme-build-process" title="Permalink to this headline">¶</a></h2>
<p>Furo’s build process uses Gulp. Running <code class="docutils literal notranslate"><span class="pre">gulp</span> <span class="pre">build</span></code> in the repository root will compile the theme’s CSS and JS assets (<code class="docutils literal notranslate"><span class="pre">src/furo/assets/</span></code>) into the correct final files (inside <code class="docutils literal notranslate"><span class="pre">src/furo/theme/furo/static</span></code>).</p>
<p>When building the distributions for upload, <code class="docutils literal notranslate"><span class="pre">gulp</span> <span class="pre">build</span></code> is run once and the <code class="docutils literal notranslate"><span class="pre">src/furo/assets/</span></code> directory is excluded for the final distribution. Thus, <em>both</em> the source distribution and wheel distribution do not contain the original source code for Furo and only contain the compiled SCSS and JS files.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is not ideal that the version-controlled source tree is not installable using pip directly. There is a need for a <code class="docutils literal notranslate"><span class="pre">gulp</span> <span class="pre">build</span></code> command to be run between the clone and installation.</p>
<p>Things are set up this way due to the lack of a “build” step support in Flit. There is <a class="reference external" href="https://github.com/takluyver/flit/issues/119#issuecomment-687779285">an open issue for enhancement with a proposal awaiting feedback</a>.</p>
</div>
</div>
<div class="section" id="how-stuff-works">
<h2>How stuff works<a class="headerlink" href="#how-stuff-works" title="Permalink to this headline">¶</a></h2>
<div class="section" id="sidebar-navigation-tree">
<h3>Sidebar Navigation Tree<a class="headerlink" href="#sidebar-navigation-tree" title="Permalink to this headline">¶</a></h3>
<p>This is was really tricky to get right. It is essentially a pure-CSS port of the Just the Docs theme’s sidebar navigation.</p>
<p>Each list item has a fixed height and a different color on hover. Items with a subtree underneath have a hidden checkbox, that is triggered when clicking the item. The checkbox holds the state of “expanded vs collapsed”, which is used in the CSS to show the subtree appropriately. The checkbox is automatically checked if it is for the current page, or a parent of the current page.</p>
<p>There was a painful amount of tweaking the CSS to get the subtrees to look just right even when there’s long text and lots of content/subtrees etc. It works now, and that’s all I care about.</p>
</div>
<div class="section" id="contents-sidebar">
<h3>Contents sidebar<a class="headerlink" href="#contents-sidebar" title="Permalink to this headline">¶</a></h3>
<p>This uses the <code class="docutils literal notranslate"><span class="pre">toc</span></code> variable that’s provided by Sphinx. There’s some CSS to hide the top-level bullet referring to this page’s title. The rest of the tree is stylised without much complexity.</p>
<p>The fancy bit is that Gumshoe.js is used to highlight the currently active heading (which heading is the content at the top pixel under). This is combined with some custom JS to scroll to the currently active heading in the toctree, which results in the contents sidebar scrolling with the user as they go.</p>
</div>
<div class="section" id="css-variables-for-customisation">
<h3>CSS variables for customisation<a class="headerlink" href="#css-variables-for-customisation" title="Permalink to this headline">¶</a></h3>
<p>This is pretty much the “USP” of this theme. In <code class="docutils literal notranslate"><span class="pre">src/furo/theme/furo/partials/_head_css_variables.html</span></code>, the user provided CSS variables are translated and written into each page’s HTML. This is set up, such that these declarations overrides any other declarations made in the CSS of the theme.</p>
<p>This essentially allows the user to control the values of the CSS variables, and hence control how the theme looks.</p>
</div>
<div class="section" id="furo-demo-directive">
<h3><code class="docutils literal notranslate"><span class="pre">furo-demo</span></code> directive<a class="headerlink" href="#furo-demo-directive" title="Permalink to this headline">¶</a></h3>
<p>This directive was written to make it easier to write the examples used in the <a class="reference internal" href="../../reference/"><span class="doc std std-doc">Reference</span></a> section. The way it works is pretty straightforward really:</p>
<ul class="simple">
<li><p>It only works in MyST documents, since it performs an in-place substitution.</p></li>
<li><p>It takes the contents of the block, splits it at “+++” into Markdown and reStructuredText snippets.</p></li>
<li><p>For both of these, it renders a tab that has a code block containing the snippet followed by the actual code itself.</p>
<ul>
<li><p>This is carefully crafted to ensure that things are evaluated correctly.</p></li>
</ul>
</li>
</ul>
<p>This approach has significant limitations however, since the A/B comparision format means that it is not directly usable to showcase functionality that is different between the two.</p>
<p>For that, we keep one of the snippets empty, which thanks to a conditional, results in the tab for that language (MyST or reST) not being rendered.</p>
</div>
</div>
</div>

      </article>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../design/">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Design Notes</div>
              </div>
              <svg><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../workflow/">
              <svg><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Workflow</div>
                
              </div>
            </a>
        </div>

        <div class="related-information">
              Copyright &#169; 2020, Pradyun Gedam
            |
            Built with <a href="https://www.sphinx-doc.org/">Sphinx</a>
              and
              <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
              <a href="https://github.com/pradyunsg/furo">Furo theme</a>.
            |
            <a class="muted-link" href="../../_sources/contributing/internals.md.txt"
               rel="nofollow">
              Show Source
            </a>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            Contents
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Internals</a><ul>
<li><a class="reference internal" href="#repository-layout">Repository Layout</a></li>
<li><a class="reference internal" href="#theme-build-process">Theme build process</a></li>
<li><a class="reference internal" href="#how-stuff-works">How stuff works</a><ul>
<li><a class="reference internal" href="#sidebar-navigation-tree">Sidebar Navigation Tree</a></li>
<li><a class="reference internal" href="#contents-sidebar">Contents sidebar</a></li>
<li><a class="reference internal" href="#css-variables-for-customisation">CSS variables for customisation</a></li>
<li><a class="reference internal" href="#furo-demo-directive"><code class="docutils literal notranslate"><span class="pre">furo-demo</span></code> directive</a></li>
</ul>
</li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </main>
</div>
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/tabs.js"></script>
    <script src="../../_static/scripts/main.js?digest=e931d09b2a40c1bb82b542effe772014573baf67"></script></body>
</html>